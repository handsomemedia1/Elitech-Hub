<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JDFJL7WM7Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-JDFJL7WM7Y');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Writer Panel - Elitech Hub</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚úçÔ∏è</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Quill.js Rich Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <style>
        :root {
            --primary: #c3151c;
            --dark: #0A0A0A;
            --light: #F9FAFB;
            --gray: #6B7280;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--light);
            color: var(--dark);
            min-height: 100vh;
        }

        /* Login Page */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark), #1a1a1a);
        }

        .login-box {
            background: white;
            padding: 3rem;
            border-radius: 1rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .login-box h1 {
            font-family: 'Space Grotesk', sans-serif;
            text-align: center;
            margin-bottom: 2rem;
        }

        /* Layout */
        .app-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: 100vh;
        }

        @media (max-width: 1200px) {
            .app-layout {
                grid-template-columns: 1fr;
            }

            .sidebar,
            .seo-panel {
                display: none;
            }
        }

        /* Sidebar */
        .sidebar {
            background: var(--dark);
            color: white;
            padding: 2rem 1rem;
        }

        .sidebar-brand {
            padding: 0 1rem;
            margin-bottom: 2rem;
        }

        .sidebar-brand img {
            height: 35px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 0.5rem;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .sidebar-nav a.active {
            background: var(--primary);
        }

        .writer-info {
            margin-top: auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
        }

        .writer-info p {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .writer-info strong {
            color: white;
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .page-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Editor */
        .editor-container {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
            padding: 0 1.5rem;
        }

        .form-group:first-child {
            padding-top: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .editor-toolbar {
            display: flex;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: #F3F4F6;
            border-bottom: 1px solid #E5E7EB;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            padding: 0.5rem 0.75rem;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            background: var(--dark);
            color: white;
        }

        .content-editor {
            min-height: 400px;
            padding: 1.5rem;
            border: none;
            outline: none;
            font-size: 1rem;
            line-height: 1.8;
        }

        .content-editor:focus {
            outline: none;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            background: #F9FAFB;
            border-top: 1px solid #E5E7EB;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(195, 21, 28, 0.4);
        }

        .btn-secondary {
            background: #E5E7EB;
            color: var(--dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* SEO Panel */
        .seo-panel {
            background: white;
            border-left: 1px solid #E5E7EB;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .seo-header {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .seo-score-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
            position: relative;
        }

        .seo-score-circle svg {
            transform: rotate(-90deg);
        }

        .seo-score-circle .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
        }

        .seo-criteria {
            list-style: none;
        }

        .seo-criteria li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #F3F4F6;
            font-size: 0.875rem;
        }

        .seo-criteria .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .seo-criteria .status.pass {
            background: #D1FAE5;
            color: var(--success);
        }

        .seo-criteria .status.fail {
            background: #FEE2E2;
            color: var(--danger);
        }

        .seo-criteria .status.warn {
            background: #FEF3C7;
            color: var(--warning);
        }

        .publish-requirements {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #FEF3C7;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .publish-requirements.ready {
            background: #D1FAE5;
        }

        .publish-requirements h4 {
            margin-bottom: 0.5rem;
        }

        /* Posts List */
        .posts-list {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .post-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #E5E7EB;
        }

        .post-item:last-child {
            border-bottom: none;
        }

        .post-info {
            flex: 1;
        }

        .post-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .post-info span {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .post-status {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .post-status.published {
            background: #D1FAE5;
            color: #065F46;
        }

        .post-status.draft {
            background: #FEF3C7;
            color: #92400E;
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed #E5E7EB;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .image-upload:hover {
            border-color: var(--primary);
            background: rgba(195, 21, 28, 0.05);
        }

        .image-upload i {
            font-size: 2rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .error-message {
            background: #FEE2E2;
            color: #991B1B;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .hidden {
            display: none !important;
        }

        /* ========== Enhanced Editor Styles ========== */
        #writerQuillEditor {
            background: white;
            min-height: 350px;
        }

        .ql-toolbar.ql-snow {
            border-radius: 0.5rem 0.5rem 0 0;
            border-color: #E5E7EB;
            background: #F3F4F6;
        }

        .ql-container.ql-snow {
            border-radius: 0 0 0.5rem 0.5rem;
            border-color: #E5E7EB;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
        }

        /* Categories Panel */
        .categories-panel {
            max-height: 140px;
            overflow-y: auto;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
        }

        .categories-panel label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0;
            font-weight: 400;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .categories-panel input[type="checkbox"] {
            width: auto;
            accent-color: var(--primary);
        }

        .add-cat-row {
            display: flex;
            gap: 0.5rem;
        }

        .add-cat-row input {
            flex: 1;
            padding: 0.4rem 0.5rem;
            border: 1px solid #E5E7EB;
            border-radius: 0.25rem;
            font-size: 0.8rem;
        }

        .btn-xs {
            padding: 0.35rem 0.55rem !important;
            font-size: 0.75rem !important;
        }

        /* Tags */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 0.4rem;
            min-height: 22px;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.6rem;
            background: linear-gradient(135deg, var(--primary), #e64545);
            color: white;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 500;
            animation: tagFadeIn 0.2s ease;
        }

        @keyframes tagFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .tag-pill .rm-tag {
            cursor: pointer;
            font-size: 0.9rem;
            line-height: 1;
            opacity: 0.8;
        }

        .tag-pill .rm-tag:hover {
            opacity: 1;
        }

        /* Featured Image Preview */
        .feat-img-preview {
            position: relative;
            margin-top: 0.5rem;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid #E5E7EB;
        }

        .feat-img-preview img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            display: block;
        }

        .feat-img-preview .rm-img {
            position: absolute;
            top: 0.4rem;
            right: 0.4rem;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Schedule */
        .schedule-opts {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .radio-lbl {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 400;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .radio-lbl input[type="radio"] {
            width: auto;
            accent-color: var(--primary);
        }

        .editor-meta-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .editor-meta-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="css/popup.css">
</head>

<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <h1>‚úçÔ∏è Writer Login</h1>
            <div id="loginError" class="error-message hidden"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required placeholder="writer@elitechhub.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>

            <div style="display: flex; align-items: center; margin: 1.5rem 0; gap: 1rem;">
                <hr style="flex: 1; border: none; border-top: 1px solid #E5E7EB;">
                <span style="color: var(--gray); font-size: 0.875rem;">or</span>
                <hr style="flex: 1; border: none; border-top: 1px solid #E5E7EB;">
            </div>

            <a href="https://elitech-hub.vercel.app/api/auth/google" class="btn"
                style="width: 100%; background: white; border: 1px solid #E5E7EB; color: var(--dark); justify-content: center;">
                <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"
                        fill="#4285F4" />
                    <path
                        d="M9.003 18c2.43 0 4.467-.806 5.956-2.18l-2.909-2.26c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.482 18 9.003 18z"
                        fill="#34A853" />
                    <path
                        d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z"
                        fill="#FBBC05" />
                    <path
                        d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.428 0 9.002 0 5.48 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z"
                        fill="#EA4335" />
                </svg>
                Sign in with Google
            </a>

            <p style="margin-top: 1.5rem; text-align: center; color: var(--gray); font-size: 0.875rem;">
                Want to become a writer? <a href="contact.html" style="color: var(--primary);">Contact us</a>
            </p>
        </div>
    </div>

    <!-- Writer Panel -->
    <div id="writerPanel" class="app-layout hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <img src="assets/images/logo.png" alt="Elitech Hub">
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="#" data-view="dashboard" class="active"><i class="fas fa-chart-pie"></i> Dashboard</a>
                    </li>
                    <li><a href="#" data-view="editor"><i class="fas fa-pen"></i> Write New</a></li>
                    <li><a href="#" data-view="posts"><i class="fas fa-list"></i> My Posts</a></li>
                    <li><a href="#" data-view="leaderboard"><i class="fas fa-trophy"></i> Leaderboard</a></li>
                    <li><a href="#" data-view="badges"><i class="fas fa-medal"></i> Badges</a></li>
                    <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
            <div class="writer-info">
                <p>Logged in as</p>
                <strong id="writerName">Writer</strong>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Editor View -->
            <div id="editorView">
                <div class="page-header">
                    <h1 class="page-title">Write New Post</h1>
                </div>

                <div class="editor-container">
                    <div class="form-group">
                        <label>Post Title</label>
                        <input type="text" id="postTitle" placeholder="Enter a compelling title..."
                            oninput="writerAutoSlug(); updateSEO()">
                    </div>

                    <div class="form-group">
                        <label>URL Slug</label>
                        <input type="text" id="postSlug" placeholder="my-post-title">
                    </div>

                    <div class="form-group">
                        <label>Excerpt / Meta Description</label>
                        <textarea id="postExcerpt" rows="2"
                            placeholder="Brief description for search results (120-160 chars)"
                            oninput="updateSEO()"></textarea>
                        <small id="excerptCount" style="color: var(--gray);">0/160 characters</small>
                    </div>

                    <div class="editor-meta-grid">
                        <!-- Dynamic Categories -->
                        <div class="form-group">
                            <label><i class="fas fa-folder"></i> Categories</label>
                            <div class="categories-panel" id="writerCategoriesPanel"></div>
                            <div class="add-cat-row">
                                <input type="text" id="writerNewCatInput" placeholder="New category...">
                                <button type="button" class="btn btn-secondary btn-xs" onclick="writerAddCategory()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="form-group">
                            <label><i class="fas fa-tags"></i> Tags</label>
                            <div class="tags-container" id="writerTagsContainer"></div>
                            <input type="text" id="writerTagInput" placeholder="Add tag, press Enter or comma..."
                                onkeydown="writerHandleTag(event)">
                        </div>
                    </div>

                    <!-- Featured Image with Preview -->
                    <div class="form-group">
                        <label><i class="fas fa-image"></i> Featured Image URL</label>
                        <input type="url" id="postThumbnail" placeholder="https://..." oninput="writerPreviewImg()">
                        <div class="feat-img-preview" id="writerImgPreview" style="display: none;">
                            <img id="writerImgPreviewEl" src="" alt="Preview">
                            <button type="button" class="rm-img" onclick="writerClearImg()">√ó</button>
                        </div>
                    </div>

                    <!-- Scheduling -->
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> Publishing</label>
                        <div class="schedule-opts">
                            <label class="radio-lbl">
                                <input type="radio" name="writerPubOption" value="now" checked
                                    onchange="writerToggleSched()"> Submit Now
                            </label>
                            <label class="radio-lbl">
                                <input type="radio" name="writerPubOption" value="schedule"
                                    onchange="writerToggleSched()"> Schedule
                            </label>
                        </div>
                        <div id="writerSchedDateTime" style="display: none;">
                            <input type="datetime-local" id="writerScheduledAt">
                        </div>
                    </div>

                    <!-- Quill Editor -->
                    <div class="form-group">
                        <label>Content</label>
                        <div id="writerQuillEditor"></div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="submitPost()">
                            <i class="fas fa-paper-plane"></i> Submit Post
                        </button>
                        <button class="btn btn-secondary" onclick="saveDraft()">
                            <i class="fas fa-save"></i> Save Draft
                        </button>
                        <button class="btn btn-secondary" onclick="previewWriterPost()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-secondary" onclick="checkSEO()">
                            <i class="fas fa-search"></i> Check SEO
                        </button>
                    </div>
                </div>
            </div>

            <!-- Posts View -->
            <div id="postsView" class="hidden">
                <div class="page-header">
                    <h1 class="page-title">My Posts</h1>
                    <button class="btn btn-primary" onclick="switchView('editor')">
                        <i class="fas fa-plus"></i> New Post
                    </button>
                </div>
                <div id="postsList" class="posts-list">
                    <p style="padding: 2rem; text-align: center; color: var(--gray);">Loading...</p>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboardView" class="hidden">
                <div class="page-header">
                    <h1 class="page-title">üìä Performance Dashboard</h1>
                </div>

                <!-- Stats Cards -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div
                        style="background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 1.5rem; border-radius: 1rem;">
                        <p style="font-size: 0.875rem; opacity: 0.9;">Published Posts</p>
                        <h2 id="statPosts" style="font-size: 2.5rem; margin: 0.5rem 0;">0</h2>
                        <p style="font-size: 0.75rem; opacity: 0.8;">Total published</p>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; padding: 1.5rem; border-radius: 1rem;">
                        <p style="font-size: 0.875rem; opacity: 0.9;">Avg SEO Score</p>
                        <h2 id="statSEO" style="font-size: 2.5rem; margin: 0.5rem 0;">0%</h2>
                        <p style="font-size: 0.75rem; opacity: 0.8;">Quality metric</p>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; padding: 1.5rem; border-radius: 1rem;">
                        <p style="font-size: 0.875rem; opacity: 0.9;">Total Views</p>
                        <h2 id="statViews" style="font-size: 2.5rem; margin: 0.5rem 0;">0</h2>
                        <p style="font-size: 0.75rem; opacity: 0.8;">Reader engagement</p>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; padding: 1.5rem; border-radius: 1rem;">
                        <p style="font-size: 0.875rem; opacity: 0.9;">Badges Earned</p>
                        <h2 id="statBadges" style="font-size: 2.5rem; margin: 0.5rem 0;">0</h2>
                        <p style="font-size: 0.75rem; opacity: 0.8;">Achievements</p>
                    </div>
                </div>

                <!-- Progression -->
                <div
                    style="background: white; border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid #E5E7EB;">
                    <h3 style="margin-bottom: 1.5rem;">üéØ Your Progress</h3>
                    <div id="progressBars" style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Posts to Author Page (20 posts)</span>
                                <span id="progressPostsLabel">0/20</span>
                            </div>
                            <div style="height: 12px; background: #E5E7EB; border-radius: 6px; overflow: hidden;">
                                <div id="progressPostsBar"
                                    style="height: 100%; width: 0%; background: linear-gradient(135deg, #10B981, #059669); transition: width 0.5s;">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Views to Traffic Driver (10,000 views)</span>
                                <span id="progressViewsLabel">0/10,000</span>
                            </div>
                            <div style="height: 12px; background: #E5E7EB; border-radius: 6px; overflow: hidden;">
                                <div id="progressViewsBar"
                                    style="height: 100%; width: 0%; background: linear-gradient(135deg, #8B5CF6, #7C3AED); transition: width 0.5s;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Level & Rank -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                    <div
                        style="background: white; border-radius: 1rem; padding: 2rem; border: 1px solid #E5E7EB; text-align: center;">
                        <h3>üèÖ Your Level</h3>
                        <p id="writerLevel"
                            style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin: 1rem 0;">Newcomer
                        </p>
                        <p style="color: var(--gray); font-size: 0.875rem;">Keep writing to level up!</p>
                    </div>
                    <div
                        style="background: white; border-radius: 1rem; padding: 2rem; border: 1px solid #E5E7EB; text-align: center;">
                        <h3>üìà Approval Rate</h3>
                        <p id="approvalRate"
                            style="font-size: 1.5rem; font-weight: 700; color: #10B981; margin: 1rem 0;">0%</p>
                        <p style="color: var(--gray); font-size: 0.875rem;">Posts approved vs submitted</p>
                    </div>
                </div>
            </div>

            <!-- Leaderboard View -->
            <div id="leaderboardView" class="hidden">
                <div class="page-header">
                    <h1 class="page-title">üèÜ Writer Leaderboard</h1>
                </div>

                <div style="background: white; border-radius: 1rem; padding: 2rem; border: 1px solid #E5E7EB;">
                    <div id="leaderboardList" style="display: flex; flex-direction: column; gap: 1rem;">
                        <p style="text-align: center; color: var(--gray);">Loading leaderboard...</p>
                    </div>
                </div>

                <!-- Monthly Winner -->
                <div
                    style="background: linear-gradient(135deg, #F59E0B, #D97706); border-radius: 1rem; padding: 2rem; margin-top: 2rem; color: white; text-align: center;">
                    <h3 style="margin-bottom: 1rem;">ü•á Monthly Champion</h3>
                    <p id="monthlyWinner" style="font-size: 1.25rem; font-weight: 700;">No winner yet this month</p>
                    <p style="font-size: 0.875rem; opacity: 0.9; margin-top: 0.5rem;">Top writer wins a FREE
                        certification course!</p>
                </div>
            </div>

            <!-- Badges View -->
            <div id="badgesView" class="hidden">
                <div class="page-header">
                    <h1 class="page-title">üéñÔ∏è Your Badges</h1>
                </div>

                <h3 style="margin-bottom: 1rem;">Earned Badges</h3>
                <div id="earnedBadges"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <p style="color: var(--gray);">No badges earned yet. Keep writing!</p>
                </div>

                <h3 style="margin-bottom: 1rem; color: var(--gray);">Available Badges</h3>
                <div id="availableBadges"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; opacity: 0.6;">
                    <p style="color: var(--gray);">Loading badges...</p>
                </div>
            </div>
        </main>

        <!-- SEO Panel -->
        <aside class="seo-panel">
            <h3 class="seo-header"><i class="fas fa-chart-line"></i> SEO Score</h3>

            <div class="seo-score-circle">
                <svg width="120" height="120">
                    <circle cx="60" cy="60" r="54" fill="none" stroke="#E5E7EB" stroke-width="12"></circle>
                    <circle id="seoCircle" cx="60" cy="60" r="54" fill="none" stroke="#10B981" stroke-width="12"
                        stroke-dasharray="339.292" stroke-dashoffset="339.292"></circle>
                </svg>
                <div class="score-value" id="seoScoreValue">0%</div>
            </div>

            <ul class="seo-criteria">
                <li>
                    <span class="status" id="titleStatus"><i class="fas fa-times"></i></span>
                    <span>Title length (30-60 chars)</span>
                </li>
                <li>
                    <span class="status" id="excerptStatus"><i class="fas fa-times"></i></span>
                    <span>Meta description (120-160)</span>
                </li>
                <li>
                    <span class="status" id="wordStatus"><i class="fas fa-times"></i></span>
                    <span>Minimum 500 words</span>
                </li>
                <li>
                    <span class="status" id="headingStatus"><i class="fas fa-times"></i></span>
                    <span>Has subheadings (H2/H3)</span>
                </li>
                <li>
                    <span class="status" id="imageStatus"><i class="fas fa-times"></i></span>
                    <span>Contains image</span>
                </li>
                <li>
                    <span class="status" id="linkStatus"><i class="fas fa-times"></i></span>
                    <span>Contains links</span>
                </li>
            </ul>

            <div id="publishRequirements" class="publish-requirements">
                <h4>üìù To Auto-Publish:</h4>
                <ul style="margin-left: 1rem; font-size: 0.8rem;">
                    <li>SEO Score ‚â• 70%</li>
                    <li>At least 500 words</li>
                    <li>At least 1 image</li>
                </ul>
            </div>

            <div style="margin-top: 1.5rem;">
                <p style="font-size: 0.75rem; color: var(--gray);">
                    <strong>Word Count:</strong> <span id="wordCount">0</span><br>
                    <strong>Reading Time:</strong> <span id="readingTime">0 min</span>
                </p>
            </div>
        </aside>
    </div>

    <script>
        const API_URL = 'https://elitech-hub.vercel.app/api';
        let token = localStorage.getItem('elitech_writer_token');

        // Check auth on load
        async function init() {
            // Handle OAuth callback
            const urlParams = new URLSearchParams(window.location.search);
            const oauthToken = urlParams.get('token');
            const oauthError = urlParams.get('error');
            const oauthName = urlParams.get('name');

            if (oauthError) {
                const errorMessages = {
                    'no_code': 'Authentication failed. Please try again.',
                    'no_account': 'No writer account found for this email. Contact admin.',
                    'inactive': 'Your writer account is inactive. Contact admin.',
                    'auth_failed': 'Google authentication failed. Please try again.'
                };
                document.getElementById('loginError').textContent = errorMessages[oauthError] || 'Authentication error';
                document.getElementById('loginError').classList.remove('hidden');
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
                showLogin();
                return;
            }

            if (oauthToken) {
                // Save token from OAuth
                token = oauthToken;
                localStorage.setItem('elitech_writer_token', token);
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
                if (oauthName) {
                    document.getElementById('writerName').textContent = decodeURIComponent(oauthName);
                }
                showPanel();
                switchView('dashboard');
                loadPosts();
                return;
            }

            if (!token) {
                showLogin();
                return;
            }

            try {
                const res = await fetch(`${API_URL}/writers/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                if (!data.writer) {
                    showLogin();
                    return;
                }

                document.getElementById('writerName').textContent = data.writer.name;
                showPanel();
                switchView('dashboard');
                loadPosts();
            } catch (err) {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('writerPanel').classList.add('hidden');
        }

        function showPanel() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('writerPanel').classList.remove('hidden');
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const res = await fetch(`${API_URL}/writers/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!res.ok) {
                    document.getElementById('loginError').textContent = data.error || 'Login failed';
                    document.getElementById('loginError').classList.remove('hidden');
                    return;
                }

                token = data.token;
                localStorage.setItem('elitech_writer_token', token);
                document.getElementById('writerName').textContent = data.writer.name;
                showPanel();
                switchView('dashboard');
                loadPosts();
            } catch (err) {
                document.getElementById('loginError').textContent = 'Connection error';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        function logout() {
            localStorage.removeItem('elitech_writer_token');
            token = null;
            showLogin();
        }

        // Navigation
        document.querySelectorAll('[data-view]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const view = link.dataset.view;
                switchView(view);
            });
        });

        function switchView(view) {
            document.querySelectorAll('[data-view]').forEach(l => l.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`)?.classList.add('active');

            // Hide all views
            document.getElementById('editorView').classList.add('hidden');
            document.getElementById('postsView').classList.add('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('leaderboardView').classList.add('hidden');
            document.getElementById('badgesView').classList.add('hidden');

            // Show selected view
            const viewMap = {
                'editor': 'editorView',
                'posts': 'postsView',
                'dashboard': 'dashboardView',
                'leaderboard': 'leaderboardView',
                'badges': 'badgesView'
            };

            if (viewMap[view]) {
                document.getElementById(viewMap[view]).classList.remove('hidden');
            }

            // Load data for specific views
            if (view === 'editor') {
                initWriterQuill();
                writerLoadCategories();
                loadDraft();
            }
            if (view === 'dashboard') loadDashboard();
            if (view === 'leaderboard') loadLeaderboard();
            if (view === 'badges') loadBadges();
        }

        // Load posts
        async function loadPosts() {
            try {
                const res = await fetch(`${API_URL}/writers/posts`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                const container = document.getElementById('postsList');
                if (!data.posts || data.posts.length === 0) {
                    container.innerHTML = '<p style="padding: 2rem; text-align: center; color: var(--gray);">No posts yet. Start writing!</p>';
                    return;
                }

                container.innerHTML = data.posts.map(post => `
                    <div class="post-item">
                        <div class="post-info">
                            <h4>${post.title}</h4>
                            <span>SEO: ${post.seo_score}% ‚Ä¢ ${post.word_count} words ‚Ä¢ ${new Date(post.created_at).toLocaleDateString()}</span>
                        </div>
                        <span class="post-status ${post.published ? 'published' : 'draft'}">
                            ${post.published ? 'Published' : 'Draft'}
                        </span>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Failed to load posts:', err);
            }
        }

        // Load Dashboard Stats
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_URL}/writers/performance/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                if (data.stats) {
                    document.getElementById('statPosts').textContent = data.stats.publishedPosts || 0;
                    document.getElementById('statSEO').textContent = (data.stats.avgSeoScore || 0) + '%';
                    document.getElementById('statViews').textContent = (data.stats.totalViews || 0).toLocaleString();
                    document.getElementById('approvalRate').textContent = (data.stats.approvalRate || 0) + '%';
                }

                if (data.progression) {
                    document.getElementById('writerLevel').textContent = data.progression.level || 'Newcomer';

                    // Update progress bars
                    const posts = data.stats?.publishedPosts || 0;
                    const views = data.stats?.totalViews || 0;

                    document.getElementById('progressPostsLabel').textContent = `${posts}/20`;
                    document.getElementById('progressPostsBar').style.width = Math.min(100, (posts / 20) * 100) + '%';

                    document.getElementById('progressViewsLabel').textContent = `${views.toLocaleString()}/10,000`;
                    document.getElementById('progressViewsBar').style.width = Math.min(100, (views / 10000) * 100) + '%';
                }

                // Load badges count
                loadBadges();
            } catch (err) {
                console.error('Failed to load dashboard:', err);
            }
        }

        // Load Leaderboard
        async function loadLeaderboard() {
            try {
                const res = await fetch(`${API_URL}/writers/performance/leaderboard?limit=10`);
                const data = await res.json();

                const container = document.getElementById('leaderboardList');
                if (!data.leaderboard || data.leaderboard.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--gray);">No writers yet. Be the first!</p>';
                    return;
                }

                container.innerHTML = data.leaderboard.map((writer, index) => `
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: ${index < 3 ? '#FEF3C7' : '#F9FAFB'}; border-radius: 0.75rem; ${index === 0 ? 'border: 2px solid #F59E0B;' : ''}">
                        <div style="font-size: 1.5rem; font-weight: 700; width: 40px; text-align: center;">
                            ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '#' + (index + 1)}
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0;">${writer.name}</h4>
                            <span style="font-size: 0.875rem; color: var(--gray);">${writer.postsCount} posts ‚Ä¢ ${writer.avgSeoScore}% SEO ‚Ä¢ ${writer.totalViews.toLocaleString()} views</span>
                        </div>
                        <div style="font-size: 1.25rem;">${writer.badgeCount} üéñÔ∏è</div>
                    </div>
                `).join('');

                // Load monthly winner
                loadMonthlyWinner();
            } catch (err) {
                console.error('Failed to load leaderboard:', err);
            }
        }

        // Load Monthly Winner
        async function loadMonthlyWinner() {
            try {
                const res = await fetch(`${API_URL}/writers/performance/monthly-winner`);
                const data = await res.json();

                if (data.winner) {
                    document.getElementById('monthlyWinner').textContent =
                        `üéâ ${data.winner.name} - ${data.winner.stats?.count || 0} posts this month!`;
                }
            } catch (err) {
                console.error('Failed to load monthly winner:', err);
            }
        }

        // Load Badges
        async function loadBadges() {
            try {
                const res = await fetch(`${API_URL}/writers/performance/badges`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                // Update badge count on dashboard
                document.getElementById('statBadges').textContent = data.earned?.length || 0;

                // Earned badges
                const earnedContainer = document.getElementById('earnedBadges');
                if (data.earned && data.earned.length > 0) {
                    earnedContainer.innerHTML = data.earned.map(badge => `
                        <div style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; padding: 1.5rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">${badge.icon}</div>
                            <h4 style="margin: 0.5rem 0; font-size: 1rem;">${badge.name}</h4>
                            <p style="font-size: 0.75rem; opacity: 0.9;">${badge.description}</p>
                        </div>
                    `).join('');
                } else {
                    earnedContainer.innerHTML = '<p style="color: var(--gray); grid-column: 1/-1;">No badges earned yet. Keep writing to unlock achievements!</p>';
                }

                // Available badges
                const availableContainer = document.getElementById('availableBadges');
                if (data.available && data.available.length > 0) {
                    availableContainer.innerHTML = data.available.map(badge => `
                        <div style="background: #F3F4F6; padding: 1.5rem; border-radius: 1rem; text-align: center; border: 2px dashed #D1D5DB;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem; filter: grayscale(100%); opacity: 0.5;">${badge.icon}</div>
                            <h4 style="margin: 0.5rem 0; font-size: 0.9rem; color: var(--gray);">${badge.name}</h4>
                            <p style="font-size: 0.7rem; color: var(--gray);">${badge.description}</p>
                        </div>
                    `).join('');
                }
            } catch (err) {
                console.error('Failed to load badges:', err);
            }
        }

        // ========== Enhanced Editor System ==========
        let writerQuill = null;
        let writerTags = [];
        let writerCategories = ['Cybersecurity', 'Scholarship', 'News', 'Tutorial', 'Research', 'Opinion', 'Case Study'];

        // Init Quill when editor view loads
        function initWriterQuill() {
            if (writerQuill) return;
            writerQuill = new Quill('#writerQuillEditor', {
                theme: 'snow',
                placeholder: 'Write your blog post content here...',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, 4, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        ['blockquote', 'code-block'],
                        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                        [{ 'indent': '-1' }, { 'indent': '+1' }],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'align': [] }],
                        ['link', 'image', 'video'],
                        ['clean']
                    ]
                }
            });
            writerQuill.on('text-change', updateSEO);
        }

        // Categories
        function writerLoadCategories() {
            const saved = localStorage.getItem('elitech_writer_categories');
            if (saved) writerCategories = JSON.parse(saved);
            writerRenderCategories();
        }

        function writerRenderCategories() {
            document.getElementById('writerCategoriesPanel').innerHTML = writerCategories.map(cat => `
                <label><input type="checkbox" name="writerCats" value="${cat}"> ${cat}</label>
            `).join('');
        }

        function writerAddCategory() {
            const input = document.getElementById('writerNewCatInput');
            const name = input.value.trim();
            if (name && !writerCategories.includes(name)) {
                writerCategories.push(name);
                localStorage.setItem('elitech_writer_categories', JSON.stringify(writerCategories));
                writerRenderCategories();
                input.value = '';
            }
        }

        // Tags
        function writerHandleTag(e) {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const tag = e.target.value.replace(',', '').trim();
                if (tag && !writerTags.includes(tag)) {
                    writerTags.push(tag);
                    writerRenderTags();
                }
                e.target.value = '';
            }
        }

        function writerRemoveTag(tag) {
            writerTags = writerTags.filter(t => t !== tag);
            writerRenderTags();
        }

        function writerRenderTags() {
            document.getElementById('writerTagsContainer').innerHTML = writerTags.map(tag => `
                <span class="tag-pill">${tag} <span class="rm-tag" onclick="writerRemoveTag('${tag}')">√ó</span></span>
            `).join('');
        }

        // Featured Image Preview
        function writerPreviewImg() {
            const url = document.getElementById('postThumbnail').value;
            const preview = document.getElementById('writerImgPreview');
            const img = document.getElementById('writerImgPreviewEl');
            if (url) {
                img.src = url;
                img.onload = () => { preview.style.display = 'block'; };
                img.onerror = () => { preview.style.display = 'none'; };
            } else {
                preview.style.display = 'none';
            }
        }

        function writerClearImg() {
            document.getElementById('postThumbnail').value = '';
            document.getElementById('writerImgPreview').style.display = 'none';
        }

        // Scheduling
        function writerToggleSched() {
            const isScheduled = document.querySelector('input[name="writerPubOption"][value="schedule"]').checked;
            document.getElementById('writerSchedDateTime').style.display = isScheduled ? 'block' : 'none';
        }

        // Auto-generate slug
        function writerAutoSlug() {
            const title = document.getElementById('postTitle').value;
            document.getElementById('postSlug').value = title.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Preview in new tab
        function previewWriterPost() {
            const title = document.getElementById('postTitle').value || 'Untitled';
            const content = writerQuill ? writerQuill.root.innerHTML : '';
            const thumbnail = document.getElementById('postThumbnail').value;
            const html = '<!DOCTYPE html><html><head>' +
                '<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">' +
                '<title>' + title + ' ‚Äî Preview</title>' +
                '<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">' +
                '<style>body{font-family:Montserrat,sans-serif;max-width:800px;margin:0 auto;padding:2rem;background:#F9FAFB;color:#0A0A0A}' +
                'h1{font-family:Space Grotesk,sans-serif;font-size:2rem;margin-bottom:1rem}' +
                '.banner{background:#FEF3C7;color:#92400E;padding:0.75rem;border-radius:0.5rem;margin-bottom:2rem;text-align:center;font-size:0.875rem}' +
                '.hero{width:100%;max-height:400px;object-fit:cover;border-radius:1rem;margin-bottom:2rem}' +
                '.body{line-height:1.8;font-size:1.05rem}.body img{max-width:100%;border-radius:0.5rem}</style>' +
                '</head><body>' +
                '<div class="banner">‚ö†Ô∏è Preview ‚Äî not yet published</div>' +
                (thumbnail ? '<img class="hero" src="' + thumbnail + '" alt="' + title + '">' : '') +
                '<h1>' + title + '</h1>' +
                '<div class="body">' + content + '</div>' +
                '</body></html>';
            window.open(URL.createObjectURL(new Blob([html], { type: 'text/html' })), '_blank');
        }

        // SEO Checker (updated for Quill)
        function updateSEO() {
            const title = document.getElementById('postTitle').value;
            const excerpt = document.getElementById('postExcerpt').value;
            const content = writerQuill ? writerQuill.root.innerHTML : '';

            // Excerpt counter
            document.getElementById('excerptCount').textContent = `${excerpt.length}/160 characters`;

            // Word count
            const text = writerQuill ? writerQuill.getText().trim() : '';
            const words = text ? text.split(/\s+/).filter(w => w.length > 0).length : 0;
            document.getElementById('wordCount').textContent = words;
            document.getElementById('readingTime').textContent = Math.ceil(words / 200) + ' min';

            // Calculate SEO score
            let score = 0;

            const titleOk = title.length >= 30 && title.length <= 60;
            updateStatus('titleStatus', titleOk);
            if (title.length > 0) score += 5;
            if (titleOk) score += 20;

            const excerptOk = excerpt.length >= 120 && excerpt.length <= 160;
            updateStatus('excerptStatus', excerptOk);
            if (excerpt.length > 0) score += 5;
            if (excerptOk) score += 10;

            const wordsOk = words >= 500;
            updateStatus('wordStatus', wordsOk);
            if (words >= 300) score += 10;
            if (wordsOk) score += 10;

            const hasHeadings = content.includes('<h2') || content.includes('<h3');
            updateStatus('headingStatus', hasHeadings);
            if (hasHeadings) score += 15;

            const hasImage = content.includes('<img');
            updateStatus('imageStatus', hasImage);
            if (hasImage) score += 15;

            const hasLink = content.includes('<a ');
            updateStatus('linkStatus', hasLink);
            if (hasLink) score += 10;

            score = Math.min(100, score);
            document.getElementById('seoScoreValue').textContent = score + '%';

            const circle = document.getElementById('seoCircle');
            const offset = 339.292 - (339.292 * score / 100);
            circle.style.strokeDashoffset = offset;
            circle.style.stroke = score >= 70 ? '#10B981' : score >= 40 ? '#F59E0B' : '#EF4444';

            const canPublish = score >= 70 && words >= 500 && hasImage;
            const requirements = document.getElementById('publishRequirements');
            if (canPublish) {
                requirements.classList.add('ready');
                requirements.innerHTML = '<h4>‚úÖ Ready to Publish!</h4><p>Your post meets all criteria for auto-publishing.</p>';
            } else {
                requirements.classList.remove('ready');
            }
        }

        function updateStatus(id, passed) {
            const el = document.getElementById(id);
            el.className = 'status ' + (passed ? 'pass' : 'fail');
            el.innerHTML = passed ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
        }

        async function checkSEO() {
            const title = document.getElementById('postTitle').value;
            const excerpt = document.getElementById('postExcerpt').value;
            const content = writerQuill ? writerQuill.root.innerHTML : '';

            try {
                const res = await fetch(`${API_URL}/writers/seo-check`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, content, excerpt })
                });
                const data = await res.json();
                alert(`SEO Score: ${data.seoScore}%\nWord Count: ${data.wordCount}\nHas Image: ${data.hasImage}\nCan Auto-Publish: ${data.canPublish}\n\nFeedback:\n${data.feedback.join('\n')}`);
            } catch (err) {
                alert('Failed to check SEO');
            }
        }

        async function submitPost() {
            const title = document.getElementById('postTitle').value;
            const slug = document.getElementById('postSlug').value;
            const excerpt = document.getElementById('postExcerpt').value;
            const content = writerQuill ? writerQuill.root.innerHTML : '';
            const selectedCats = Array.from(document.querySelectorAll('input[name="writerCats"]:checked')).map(cb => cb.value);
            const category = selectedCats.join(', ') || 'Uncategorized';
            const thumbnail = document.getElementById('postThumbnail').value;
            const isScheduled = document.querySelector('input[name="writerPubOption"][value="schedule"]')?.checked;
            const scheduledAt = isScheduled ? document.getElementById('writerScheduledAt').value : null;

            if (!title || !content || content === '<p><br></p>') {
                alert('Title and content are required');
                return;
            }

            try {
                const res = await fetch(`${API_URL}/writers/posts`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, slug, excerpt, content, category, thumbnail, tags: writerTags, scheduled_at: scheduledAt })
                });
                const data = await res.json();

                if (!res.ok) {
                    alert(data.error + (data.issues ? '\n\n' + data.issues.join('\n') : ''));
                    return;
                }

                alert(data.message + `\n\nSEO Score: ${data.seoScore}%\n\n${data.feedback.join('\n')}`);

                // Clear form
                document.getElementById('postTitle').value = '';
                document.getElementById('postSlug').value = '';
                document.getElementById('postExcerpt').value = '';
                if (writerQuill) writerQuill.setText('');
                document.getElementById('postThumbnail').value = '';
                document.getElementById('writerImgPreview').style.display = 'none';
                writerTags = [];
                writerRenderTags();
                updateSEO();
                loadPosts();
            } catch (err) {
                alert('Failed to submit post');
            }
        }

        // Functional draft save via localStorage
        function saveDraft() {
            const draft = {
                title: document.getElementById('postTitle').value,
                slug: document.getElementById('postSlug').value,
                excerpt: document.getElementById('postExcerpt').value,
                content: writerQuill ? writerQuill.root.innerHTML : '',
                thumbnail: document.getElementById('postThumbnail').value,
                tags: writerTags,
                categories: Array.from(document.querySelectorAll('input[name="writerCats"]:checked')).map(cb => cb.value),
                savedAt: new Date().toISOString()
            };
            localStorage.setItem('elitech_writer_draft', JSON.stringify(draft));
            alert('‚úÖ Draft saved! It will be restored next time you open the editor.');
        }

        // Load draft on editor open
        function loadDraft() {
            const saved = localStorage.getItem('elitech_writer_draft');
            if (!saved) return;
            const draft = JSON.parse(saved);
            const age = (Date.now() - new Date(draft.savedAt).getTime()) / 1000 / 60;
            if (age > 1440) return; // Ignore drafts older than 24 hours

            if (confirm('You have a saved draft from ' + new Date(draft.savedAt).toLocaleString() + '. Restore it?')) {
                document.getElementById('postTitle').value = draft.title || '';
                document.getElementById('postSlug').value = draft.slug || '';
                document.getElementById('postExcerpt').value = draft.excerpt || '';
                if (writerQuill && draft.content) {
                    writerQuill.root.innerHTML = draft.content;
                }
                document.getElementById('postThumbnail').value = draft.thumbnail || '';
                writerTags = draft.tags || [];
                writerRenderTags();
                writerPreviewImg();
                // Restore categories
                if (draft.categories) {
                    draft.categories.forEach(cat => {
                        const cb = document.querySelector(`input[name="writerCats"][value="${cat}"]`);
                        if (cb) cb.checked = true;
                    });
                }
                updateSEO();
            }
        }

        // Init
        init();
    </script>
    <!-- Cookie Consent Banner -->
    <script src="js/popup-engine.js"></script>
    <script src="js/cookie-consent.js"></script>
</body>

</html>